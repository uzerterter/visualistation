<!DOCTYPE html>
<meta charset="utf-8">
<script src="http://d3js.org/d3.v3.min.js"></script>

<style>
    /* Sets up the body to use Flexbox for centering its children elements */
    body {
        display: flex;
        justify-content: center;
        align-items: center; 
        height: 100vh;
        margin: 0; 
        }
    /* Style for the svg that contains the map */
    svg {
        width: 100vw; 
        height: 100vh; 
        background: #EAE2B7;
    }

    /* Default federal state style */
    .state {
        fill: #FCBF49;
        stroke: #fff;
        stroke-width: 1.25px;
        opacity: 0.85;
    }

    /* Hover style for individual states */
    .state:hover {
        fill: #F77F00;
    }

    /* Active (clicked) style for federal states*/ 
    .state.active {
        fill: #F77F00;
    }

</style>

<body>

    <div id="map"></div>

    <script>

        /* sets up variables and the dimensions of the map */ 
        var width = window.innerWidth,
            height = window.innerHeight,
            margin = { top: 0, left: 0, right: 0, bottom: 0 },
            geoPath;
        
        /* keeps tracked if a state is currently clicked (active) or not */ 
        var focused = null;

        // places the map svg
        var svg = d3.select("body")
            .append("svg")

        // appends a g (grouping) element to the svg, holds the map paths
        var g = svg.append("g")
            .append("g")
            .attr("id", "states");

        // draws the map from geojson data
        d3.json("src/lib/data/dataBundesLander.json", function (collection) {

            var bounds = d3.geo.bounds(collection),
                bottomLeft = bounds[0],
                topRight = bounds[1],
                rotLong = -(topRight[0] + bottomLeft[0]) / 2,
                center = [(topRight[0] + bottomLeft[0]) / 2 + rotLong, (topRight[1] + bottomLeft[1]) / 2],

                // default scale projection
                projection = d3.geo.albers()
                    .parallels([bottomLeft[1], topRight[1]])
                    .rotate([rotLong, 0, 0])
                    .translate([width / 2, height / 2])
                    .center(center),

                bottomLeftPx = projection(bottomLeft),
                topRightPx = projection(topRight),
                scaleFactor = 1.00 * Math.min(width / (topRightPx[0] - bottomLeftPx[0]), height / (-topRightPx[1] + bottomLeftPx[1])),

                // original size of the map
                projection = d3.geo.albers()               
                    .parallels([bottomLeft[1], topRight[1]])
                    .rotate([rotLong, 0, 0])
                    .translate([width / 2, height / 2])
                    .scale(scaleFactor * 1000)
                    .center(center);

            // path generator
            geoPath = d3.geo.path().projection(projection);

            // binds the geojson data to path elements and adds them to the svg
            g.selectAll("path.feature") 
                .data(collection.features)
                .enter()
                .append("path")
                .attr("class", "state")
                .attr("d", geoPath)
                .on("click", function(d) {
                    clickPath(d); // Call clickPath function when a path is clicked
                });


        });

        // handles zooming in on federal states when they're clicked
        function clickPath(d) {
            var stateId = d.properties.ID_1; // Get the state ID from the data

            if (focused === d) {
                // If the same state is clicked again, reset the zoom
                resetZoom();
            } else {
                // Calculate the new scale and translate values for zooming in
                var centroid = geoPath.centroid(d),
                    x = centroid[0],
                    y = centroid[1],
                    k = 1.5;   // scaling factor
                focused = d;

                // applies the zoom transform to the map
                g.transition()
                    .duration(750)
                    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
                    .style("stroke-width", 1.5 / k + "px");

                // calsl the function for the specific state
                handleStateClick(stateId);
            }

            // handles the class for active states
            g.selectAll("path")
                .classed("active", focused && function(d) { return d === focused; });
        }
        
        // handles zooming out again when a state is clicked a second time
        function resetZoom() {
            focused = null;
            g.transition()
                .duration(750)
                .attr("transform", "")
                .style("stroke-width", "1.5px");
            g.selectAll("path").classed("active", false);
        }

        // handles clicks on the map and calls functions for each federal state
        function handleStateClick(stateId) {
            var stateFunctionMap = {
                1: function1,
                12: function12,
                // Map other state IDs to their respective functions
            };

            if (stateFunctionMap[stateId]) {
                stateFunctionMap[stateId]();
            } else {
                console.log("No specific function for state ID " + stateId);
            }
        }

        // Define your specific functions for each federal state here!
        function function1() {
            console.log("Function for state 1 called");
            // Implement functionality
        }

        function function12() {
            console.log("Function for state 12 called");
        }
        
    </script>

</body>
</html>
